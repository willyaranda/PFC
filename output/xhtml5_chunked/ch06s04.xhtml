<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Verificación de notificaciones</title><link rel="stylesheet" type="text/css" href="docbook.css"/><meta name="generator" content="DocBook XSL Stylesheets V1.77.1"/><link rel="prev" href="ch06s03.xhtml" title="Notificaciones firmadas"/><link rel="next" href="ch06s05.xhtml" title="Ataque DDoS: flooding y replay"/></head><body><header><div class="navheader"><table style="width: 100%; "><tr><th style="text-align: center; " colspan="3">Verificación de notificaciones</th></tr><tr><td style="width: 20%; text-align: left; "><a accesskey="p" href="ch06s03.xhtml">Anterior</a> </td><th style="width: 60%; text-align: center; ">Capítulo 6. Seguridad</th><td style="width: 20%; text-align: right; "> <a accesskey="n" href="ch06s05.xhtml">Siguiente</a></td></tr></table><hr/></div></header><section class="section" id="idp571664"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Verificación de notificaciones</h2></div></div></div><p>
      En cuanto llega una notificación, o dicho de otra manera, cualquier mensaje mediante una petición <code class="code">POST</code> a la interfaz que expone el servidor de notificaciones hacia el exterior (en este caso se habla del <code class="code">API</code> hacia el Application Server o <code class="code">AS</code>), hay que comprobar una serie de criterios para verificar que la notificación es correcta.
    </p><p>
      En primer lugar, se comprueba que el mensaje enviado es un mensaje <code class="code">JSON</code> bien formado, con la función <code class="code">JSON.parse(notification)</code> nativa de JavaScript. Si es así, se pasa a verificar el resto de campos, de la forma:
    </p><p>
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
            Que el atributo <code class="code">messageType</code> de la notificación es igual a la cadena <code class="code">notification</code>.
          </p></li><li class="listitem"><p>
            Que esté correctamente firmado, como se explica en la sección anterior. Esto significa que tenga el atributo <code class="code">signature</code> y que además sea válido.
          </p></li><li class="listitem"><p>
            Que tenga un identificador externo, es decir, que el atributo <code class="code">id</code> no esté sin definir (<code class="code">undefined</code> al parsear el <code class="code">JSON</code>) o ser nulo, puesto que en un futuro se podría agregar la opción de sobreescribir notificaciones y poder preguntar por el estado de la entrega de una notificación a través de este identificador único para el servicio de terceros o <code class="code">AS</code>.
          </p></li><li class="listitem"><p>
            Que el atributo <code class="code">message</code> e <code class="code">id</code> no supere los 4KiB, ya que la longitud máxima que se permite en el servidor es de 4KiB. Probablemente en el futuro se cambie la restricción de tamaño para la parte de <code class="code">id</code> y se obligue a un tamaño más pequeño, ya que 4096 bytes de identificación es suficiente para cualquier aplicación.
          </p></li></ul></div><p>
    </p><p>
      A partir de este momento, la notificación, si es válida, pasa al sistema que lo entregará a los dispositivos a los que iba destinada, eliminando algunos campos, como <code class="code">signature</code> (para evitar ataques replay), y lo dejará de la siguiente manera:
    </p><div class="figure" id="idp585952"><div class="figure-title">Figura 6.6. Notificación normalizada</div><div class="figure-contents"><pre class="programlisting">
{
  "messageType": "notification",
  "id": 1234,
  "message": "Hola",
  "ttl": 2592000,
  "timestamp": "1356102444115",
  "priority": 1
}
      </pre></div></div><br class="figure-break"/></section><footer><div class="navfooter"><hr/><table style="width: 100%; "><tr><td style="width: 40%; text-align: left; "><a accesskey="p" href="ch06s03.xhtml">Anterior</a> </td><td style="width: 20%; text-align: center; "><a accesskey="u" href="ch06.xhtml">Subir</a></td><td style="width: 40%; text-align: right; "> <a accesskey="n" href="ch06s05.xhtml">Siguiente</a></td></tr><tr><td style="width: 40%; text-align: left; vertical-align: top; ">Notificaciones firmadas </td><td style="width: 20%; text-align: center; "><a accesskey="h" href="index.xhtml">Inicio</a></td><td style="width: 40%; text-align: right; vertical-align: top; "> Ataque DDoS: flooding y replay</td></tr></table></div></footer></body></html>
